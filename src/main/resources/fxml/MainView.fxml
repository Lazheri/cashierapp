<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.image.ImageView?>

<BorderPane xmlns="http://javafx.com/javafx/11.0.1" xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.cashier.controller.MainController" stylesheets="@../css/style.css">
   <top>
      <VBox>
         <MenuBar>
            <menus>
               <Menu mnemonicParsing="false" text="Fichier">
                  <items>
                     <MenuItem mnemonicParsing="false" onAction="#handleExit" text="Quitter" />
                  </items>
               </Menu>
               <Menu mnemonicParsing="false" text="Gestion">
                  <items>
                     <MenuItem mnemonicParsing="false" onAction="#showProductManagement" text="Gestion des Produits" />
                     <MenuItem mnemonicParsing="false" onAction="#showPromotionManagement" text="Gestion des Promotions" />
                     <MenuItem mnemonicParsing="false" onAction="#showSalesHistory" text="Historique des Ventes" />
                  </items>
               </Menu>
            </menus>
         </MenuBar>
         
         <!-- App Bar -->
         <HBox spacing="15.0" styleClass="app-bar" alignment="CENTER_LEFT">
            <padding>
               <Insets top="10.0" right="20.0" bottom="10.0" left="20.0" />
            </padding>
            <children>
               <Label text="Recherche:" styleClass="app-bar-label"/>
               <TextField fx:id="searchField" promptText="Nom du produit..." prefWidth="200.0" styleClass="search-field"/>
               
               <Label text="Code-barres:" styleClass="app-bar-label"/>
               <TextField fx:id="barcodeField" promptText="Scan..." prefWidth="150.0" styleClass="barcode-field"/>
               
               <Label text="Catégorie:" styleClass="app-bar-label"/>
               <ComboBox fx:id="categoryFilter" prefWidth="150.0" promptText="Toutes" styleClass="category-filter"/>
               
               <Region HBox.hgrow="ALWAYS" />
               
               <Label fx:id="connectionStatusLabel" text="En ligne" styleClass="status-online" />
            </children>
         </HBox>
      </VBox>
   </top>
   
   <center>
      <!-- Product Grid -->
      <ScrollPane fitToWidth="true" fitToHeight="true" styleClass="product-scroll-pane">
         <content>
            <TilePane fx:id="productGrid" hgap="15.0" vgap="15.0" prefColumns="4" tileAlignment="TOP_LEFT" styleClass="product-grid">
               <padding>
                  <Insets top="15.0" right="15.0" bottom="15.0" left="15.0" />
               </padding>
            </TilePane>
         </content>
      </ScrollPane>
   </center>
   
   <right>
      <!-- Cart Panel -->
      <VBox prefWidth="400.0" spacing="10.0" styleClass="cart-panel">
         <padding>
            <Insets bottom="10.0" left="10.0" right="10.0" top="10.0" />
         </padding>
         <children>
            <Label styleClass="section-title" text="Panier" />
            
            <TableView fx:id="cartTable" VBox.vgrow="ALWAYS" editable="true">
               <columns>
                  <TableColumn fx:id="cartProductColumn" prefWidth="120.0" text="Produit" />
                  <TableColumn fx:id="cartQuantityColumn" prefWidth="60.0" text="Qté" />
                  <TableColumn fx:id="cartPriceColumn" prefWidth="70.0" text="P.U." />
                  <TableColumn fx:id="cartDiscountColumn" prefWidth="70.0" text="Remise" />
                  <TableColumn fx:id="cartTotalColumn" prefWidth="70.0" text="Total" />
               </columns>
               <columnResizePolicy>
                  <TableView fx:constant="CONSTRAINED_RESIZE_POLICY" />
               </columnResizePolicy>
            </TableView>
            
            <!-- Cart Actions -->
            <HBox spacing="10.0">
               <children>
                  <Button onAction="#removeFromCart" text="Supprimer" styleClass="action-button-secondary"/>
                  <Button onAction="#clearCart" text="Vider" styleClass="action-button-danger"/>
               </children>
            </HBox>
            
            <Separator />

            <!-- Discount Panel -->
            <VBox spacing="8.0" styleClass="discount-panel">
               <children>
                  <Label text="Remises" styleClass="section-subtitle" />

                  <HBox spacing="5.0">
                     <children>
                        <Label text="Manuelle %:" />
                        <TextField fx:id="manualPercentDiscountField" prefWidth="80.0" promptText="0" />
                        <Button onAction="#applyManualPercentDiscount" text="Appliquer %" styleClass="action-button-small" />
                     </children>
                  </HBox>

                  <HBox spacing="5.0">
                     <children>
                        <Label text="Manuelle TND:" />
                        <TextField fx:id="manualFixedDiscountField" prefWidth="80.0" promptText="0" />
                        <Button onAction="#applyManualFixedDiscount" text="Appliquer TND" styleClass="action-button-small" />
                     </children>
                  </HBox>

                  <Separator />

                  <HBox spacing="5.0">
                     <children>
                        <Label text="Code Promo:" />
                        <TextField fx:id="promoCodeField" prefWidth="120.0" promptText="Entrez le code..." />
                        <Button onAction="#applyPromoCode" text="Appliquer" styleClass="action-button-small" />
                     </children>
                  </HBox>

                  <Label fx:id="discountMessageLabel" styleClass="discount-message-label" wrapText="true" text="" />
               </children>
            </VBox>

            <Separator />

            <!-- Totals -->
            <VBox spacing="5.0" styleClass="totals-box">
               <children>
                  <HBox alignment="CENTER_RIGHT">
                     <children>
                        <Label text="Sous-total: " styleClass="subtotal-label-text"/>
                        <Label fx:id="subtotalLabel" styleClass="subtotal-value" text="0.000 TND" />
                     </children>
                  </HBox>
                  <HBox alignment="CENTER_RIGHT">
                     <children>
                        <Label text="Remise: " styleClass="discount-label-text"/>
                        <Label fx:id="discountLabel" styleClass="discount-value" text="0.000 TND" />
                     </children>
                  </HBox>
                  <HBox alignment="CENTER_RIGHT">
                     <children>
                        <Label text="TOTAL: " styleClass="total-label-text"/>
                        <Label fx:id="totalLabel" styleClass="total-value" text="0.000 TND" />
                     </children>
                  </HBox>
               </children>
            </VBox>
            
            <!-- Spinner for manual quantity (hidden or auxiliary) -->
             <HBox spacing="10.0" alignment="CENTER_LEFT" visible="false" managed="false">
                <children>
                   <Label text="Qté manuelle:" />
                   <Spinner fx:id="quantitySpinner" initialValue="1" min="0" max="9999" editable="true" prefWidth="80.0" />
                </children>
             </HBox>

            <!-- Payment Buttons -->
            <VBox spacing="10.0">
               <children>
                  <Button fx:id="payButton" onAction="#processPayment" prefHeight="50.0" maxWidth="Infinity" styleClass="pay-button" text="PAYER" />
                  <Button onAction="#cancelSale" prefHeight="40.0" maxWidth="Infinity" styleClass="cancel-button" text="Annuler Vente" />
               </children>
            </VBox>
            
            <!-- Messages -->
            <Label fx:id="messageLabel" styleClass="message-label" wrapText="true" />
         </children>
      </VBox>
   </right>
</BorderPane>
